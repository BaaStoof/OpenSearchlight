<!DOCTYPE html>  <html> <head>   <title>OpenSearchlight-0.2.1.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               OpenSearchlight-0.2.1.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*! Opensearchlight - v0.2.1 - 2013-02-17</span>
<span class="cm">* https://github.com/nsidc/OpenSearchlight</span>
<span class="cm">* Copyright (c) 2013 Regents of the University of Colorado; Licensed MIT */</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>About</h2>

<p>OpenSearchlight is a client library to access <a href="http://www.opensearch.org">OpenSearch</a> services.</p>

<h2>Usage</h2>

<p><code>openSearchService</code> is the primary entry point to OpenSearchlight. Use it to
generate an <code>OpenSearchQuery</code> instance. The OSDD of the service is
retrieved, parsed, and passed into the <code>OpenSearchQuery</code> instance which is
in turn passed to a callback function. Handling and parsing of the OSDD
itself is handled by instances of <code>OpenSearchDescriptionDocument</code>.</p>

<p>Use the query object (passed as the callback's parameter) to hit the search
service and get back results.</p>

<p>Typical usage:</p>

<pre><code>OpenSearchlight.query({
   osdd: "http://www.example.com/opensearch?description",
   contentType: "text/xml",
   parameters: {
      searchTerms: "some search words",
      startPage: "20",
      resultsPerPage: "100"
   },
   success: function (data) {
      // data contains results!
   },
   error: function (jqXHR, textStatus, errorThrown) {
      // error handling...
   }
});
</code></pre>

<p>The above is equivalent to the following code, which uses the objects in the
API explicitly:</p>

<pre><code>OpenSearchlight.openSearchService.query(
   "http://www.example.com/opensearch?description", 
   function (query) {
      query
         .set("searchTerms", "some search words")
         .set("startPage", "20")
         .set("resultsPerPage", "100")
         .setContentType("text/xml")
         .execute({
            success: function (data) {
               // data contains results!
            },
            error: function (jqXHR, textStatus, errorThrown) {
               // error handling...
            }
         });
   });
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>OpenSearchlight</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Declare the global object everything lives in</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">OpenSearchlight</span> <span class="o">=</span> <span class="nx">OpenSearchlight</span> <span class="o">||</span> <span class="p">{};</span>

<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Top-level facade for all the rest of the API.</p>

<ul>
<li><code>params</code>: object literal, containing:
<ul><li><code>osdd</code>: URL of the OpenSearch service's OSDD</li>
<li><code>parameters</code>: search parameters to substitute into the search templates</li>
<li><code>success</code>: callback function to call with the results. The results will be passed as the first argument to the function.</li>
<li><code>contentType</code>: contentType requested of the service</li>
<li><code>error</code>: callback function if the opensearch query fails</li></ul></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">query</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">queryFunction</span><span class="p">;</span>

    <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">ensureParamsNotEmpty</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
    <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">ensureParamsHasOsdd</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
    <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">ensureParamsHasSuccessHandler</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>

    <span class="nx">queryFunction</span> <span class="o">=</span> <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">generateOsddSuccessFn</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
    <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">openSearchService</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">osdd</span><span class="p">,</span> <span class="nx">queryFunction</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Generator for the onSuccess method used when the OSDD is
successfully retrieved</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">generateOsddSuccessFn</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">queryParams</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">params</span> <span class="k">instanceof</span> <span class="nb">Object</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Extract query parameters</p>             </td>             <td class="code">               <div class="highlight"><pre>           <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">parameters</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">query</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
           <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Extract desired content type</p>             </td>             <td class="code">               <div class="highlight"><pre>           <span class="k">if</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">contentType</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">query</span><span class="p">.</span><span class="nx">setContentType</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">contentType</span><span class="p">);</span>
           <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">queryParams</span> <span class="o">=</span> <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">extendWith</span><span class="p">({},</span> <span class="nx">params</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">]);</span>
        <span class="nx">query</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">queryParams</span><span class="p">);</span>
     <span class="p">};</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Copy selected properties from the <code>src</code> object to the <code>dest</code> object.
Returns a new object with the combined properties.</p>

<ul>
<li><code>dest</code>: object that new properties are added to</li>
<li><code>src</code>: object that properties are copied from</li>
<li><code>props</code>: a property or a list of properties to copy</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">extendWith</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dest</span><span class="p">,</span> <span class="nx">src</span><span class="p">,</span> <span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
     <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">dest</span><span class="p">),</span>
         <span class="nx">propsToCopy</span> <span class="o">=</span> <span class="p">[];</span>

     <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">src</span> <span class="o">!==</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="nx">propsToCopy</span> <span class="o">=</span> <span class="nx">arrayify</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>

     <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">propsToCopy</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">prop</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">src</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">prop</span><span class="p">))</span> <span class="p">{</span>
           <span class="nx">result</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">src</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
        <span class="p">}</span>
     <span class="p">});</span>

     <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h2>Helper functions for OpenSearchlight</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Converts scalar arguments into arrays with the scalar as the first array element.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">arrayify</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
     <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">[];</span>
     <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">p</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">p</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">a</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">a</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">ensureParamsNotEmpty</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">params</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Must pass a params object&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">ensureParamsHasOsdd</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">params</span><span class="p">.</span><span class="nx">osdd</span> <span class="o">!==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Must pass an osdd value in the params object&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">ensureParamsHasSuccessHandler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">params</span><span class="p">.</span><span class="nx">success</span> <span class="o">!==</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Must pass a success handler in the params object&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

<span class="p">}());</span>

<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h2>OpenSearchQuery</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">OpenSearchQuery</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p><strong>OpenSearchQuery</strong> wraps up your query on an OpenSearch endpoint.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">OpenSearchQuery</span> <span class="o">=</span> <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">OpenSearchQuery</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Instance methods</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">OpenSearchQuery</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>"constructor" - requires the xml of an OSDD or a fully formed OpenSearchDescriptionDocument</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">osddXml</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Must pass OSDD&#39;s XML&quot;</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">osddXml</span> <span class="k">instanceof</span> <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">OpenSearchDescriptionDocument</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">openSearchDescriptionDocument</span> <span class="o">=</span> <span class="nx">osddXml</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">osddXml</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">openSearchDescriptionDocument</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createOpenSearchDescriptionDocument</span><span class="p">(</span><span class="nx">osddXml</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Invalid argument to OpenSearchQuery&quot;</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">searchParams</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Set a search parameter.  Chainable method.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Set the desired content type to retrieve from the server. If the server
does not provide an endpoint that matches this value, you're liable to
get an error.  Chainable method.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">setContentType</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">contentType</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">contentType</span> <span class="o">=</span> <span class="nx">contentType</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Performs the current query.</p>

<ul>
<li><code>options</code>: object literal containing the following:
<ul><li><code>url</code>: URL to GET</li>
<li><code>success</code>: callback function for successful queries.  Should accept one parameter: the results.</li>
<li><code>error</code> (optional): callback function for error conditions.  Can take three
parameters: <code>jqXHR</code>, <code>textStatus</code>, and <code>errorThrown</code> (see
<a href="http://api.jquery.com/jQuery.ajax/">http://api.jquery.com/jQuery.ajax/</a>)</li></ul></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">execute</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">queryUrl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">openSearchDescriptionDocument</span><span class="p">.</span><span class="nx">getQueryUrl</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getParams</span><span class="p">(),</span> <span class="k">this</span><span class="p">.</span><span class="nx">getContentType</span><span class="p">());</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="nx">url</span><span class="o">:</span> <span class="nx">queryUrl</span><span class="p">,</span>
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">jqXhr</span><span class="p">)</span> <span class="p">{</span> 
          <span class="nx">options</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span> 
        <span class="p">},</span>
        <span class="nx">error</span><span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">error</span>
      <span class="p">});</span>
    <span class="p">},</span>

    <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
    <span class="p">},</span>

    <span class="nx">getContentType</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">contentType</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">getParams</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">createOpenSearchDescriptionDocument</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">osddXml</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">OpenSearchDescriptionDocument</span><span class="p">(</span><span class="nx">osddXml</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Class methods - none!</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">OpenSearchQuery</span><span class="p">,</span> <span class="p">{</span>
  <span class="p">});</span>

<span class="p">}(</span><span class="nx">jQuery</span><span class="p">,</span> <span class="nx">_</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h2>openSearchService</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Factory to create an OpenSearchQuery</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">openSearchService</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Retrieves the OSDD at the specified url (if necessary), and calls back to
onSuccess when complete, providing onSuccess a query object to work with.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">query</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">onSuccess</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
        <span class="nx">success</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">jqXhr</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">onSuccess</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">createQueryObject</span><span class="p">(</span><span class="nx">jqXhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">));</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
      <span class="p">});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Creates an OpenSearchQuery object. Easy to override if you don't actually
want to incur the cost of that, e.g. for testing.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">createQueryObject</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">osddXml</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">OpenSearchQuery</span><span class="p">(</span><span class="nx">osddXml</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

<span class="p">}(</span><span class="nx">jQuery</span><span class="p">,</span> <span class="nx">_</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h2>OpenSearchDescriptionDocument</h2>

<p><code>OpenSearchDescriptionDocument</code> wraps up parsing the good stuff out of an
OSDD, and generates the query URL for someone else to GET later on.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Hide the internals within the closure scope. Pull in jQuery and Underscore
from the environment.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Shortcut name</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">OSDD</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Create a simple constructor function; behaviors will be added shortly.
Just like the backbone.js way.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">OSDD</span> <span class="o">=</span> <span class="nx">OpenSearchlight</span><span class="p">.</span><span class="nx">OpenSearchDescriptionDocument</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">osddXml</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p><em>Instance methods</em></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">OSDD</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Override <code>initialize</code> to override the default constructor behavior.</p>

<ul>
<li><code>osddXml</code>: the XML content of an OSDD</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">osddXml</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">OSDD</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="nx">osddXml</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Error parsing xml&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">osddXml</span> <span class="o">=</span> <span class="nx">osddXml</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Based on the OSDD template URLs, the search parameters and the desired
content type, construct the best fitting query URL.  Content type has
the highest priority; search parameters are lower.  Parameters without a
match in the template are ignored.</p>

<ul>
<li><code>params</code>: an object containing template parameters and their values to
substitute into the template url</li>
<li><code>contentType</code>: string with the desired content type, e.g. "text/xml"</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getQueryUrl</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">contentType</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">urlTemplates</span><span class="p">,</span> <span class="nx">template</span><span class="p">,</span> <span class="nx">queryUrl</span><span class="p">;</span>
      <span class="nx">urlTemplates</span> <span class="o">=</span> <span class="nx">OSDD</span><span class="p">.</span><span class="nx">extractTemplateUrls</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">osddXml</span><span class="p">);</span>
      <span class="nx">template</span> <span class="o">=</span> <span class="nx">OSDD</span><span class="p">.</span><span class="nx">getBestTemplate</span><span class="p">(</span><span class="nx">urlTemplates</span><span class="p">,</span> <span class="nx">contentType</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
      <span class="nx">queryUrl</span> <span class="o">=</span> <span class="nx">OSDD</span><span class="p">.</span><span class="nx">substituteTemplateParameters</span><span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">queryUrl</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p><em>Class methods</em>.  These are internal methods, but exposed for overriding as
necessary.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">OSDD</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Validate the OSDD XML.  Returns <code>true</code> if XML is valid OSDD. 
<em>Not currently very sophisticated...</em></p>

<ul>
<li><code>osddXml</code>: string with the XML of the OSDD</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">validate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">osddXml</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">osddXml</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>TODO: replace this naive text matching with some actual XML parsing</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">osddXml</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/http:\/\/a9.com\/-\/spec\/opensearch\/1.1\//</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Returns an array of JSON objecs representing the template URLs found in
the OSDD XML, or undefined if none are found.</p>

<ul>
<li><code>osddXml</code>: string with the XML of the OSDD</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">extractTemplateUrls</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">osddXml</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">templates</span> <span class="o">=</span> <span class="p">[],</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>TODO: would be nice to remove the dependency on jQuery here:</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">jqTemplates</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">osddXml</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;url[rel!=self]&#39;</span><span class="p">);</span>

      <span class="nx">jqTemplates</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">templates</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">),</span>
            <span class="nx">template</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&quot;template&quot;</span><span class="p">)</span>
          <span class="p">});</span>
      <span class="p">});</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">templates</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">templates</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Parameters:</p>

<ul>
<li><code>urlTemplates</code>: array of <code>{ type: "contentType", template: "urlTemplate" }</code> objects, as found in the OSDD</li>
<li><code>contentType</code>: requested content type, e.g. <code>"application/json"</code></li>
<li><code>params</code>: object containing search parameters</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">getBestTemplate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">urlTemplates</span><span class="p">,</span> <span class="nx">contentType</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">filteredByType</span><span class="p">,</span> <span class="nx">filteredByRequiredParams</span><span class="p">,</span> <span class="nx">bestMatch</span><span class="p">;</span>
      <span class="nx">filteredByType</span> <span class="o">=</span> <span class="nx">OSDD</span><span class="p">.</span><span class="nx">filterUrlTemplatesOnMimeType</span><span class="p">(</span><span class="nx">urlTemplates</span><span class="p">,</span> <span class="nx">contentType</span><span class="p">);</span>
      <span class="nx">filteredByRequiredParams</span> <span class="o">=</span> <span class="nx">OSDD</span><span class="p">.</span><span class="nx">filterUrlTemplatesWithMissingRequiredParams</span><span class="p">(</span><span class="nx">filteredByType</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
      <span class="nx">bestMatch</span> <span class="o">=</span> <span class="nx">OSDD</span><span class="p">.</span><span class="nx">findTemplateWithMostParamMatches</span><span class="p">(</span><span class="nx">filteredByRequiredParams</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">bestMatch</span><span class="p">.</span><span class="nx">template</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">filterUrlTemplatesOnMimeType</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">urlTemplates</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">urlTemplates</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">urlTemplate</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">OSDD</span><span class="p">.</span><span class="nx">doesContentTypeMatch</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">urlTemplate</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Perform some simple content type matching. Returns true if the type does
match the matcher, false otherwise.</p>

<ul>
<li><code>matcher</code>: desired content type.  Wildcards, e.g. <code>"*/*"</code> or <code>"text/*"</code> are allowed.</li>
<li><code>type</code>: content type to match against</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">doesContentTypeMatch</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">matcher</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">matcher_parts</span><span class="p">,</span> <span class="nx">type_parts</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">matcher</span> <span class="o">===</span> <span class="s2">&quot;*/*&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">matcher</span> <span class="o">===</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="nx">matcher_parts</span> <span class="o">=</span> <span class="nx">matcher</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">);</span>
      <span class="nx">type_parts</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">matcher_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">type_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">matcher_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">matcher_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;*&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">matcher_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="nx">type_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Return the subset of templates in the <code>urlTemplates</code> array whose
required params are available in the <code>params</code> object</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">filterUrlTemplatesWithMissingRequiredParams</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">urlTemplates</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">urlTemplates</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">urlTemplate</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">OSDD</span><span class="p">.</span><span class="nx">areAllRequiredParamsPresent</span><span class="p">(</span><span class="nx">urlTemplate</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">},</span>


    <span class="nx">areAllRequiredParamsPresent</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
       <span class="kd">var</span> <span class="nx">allParams</span><span class="p">,</span> <span class="nx">requiredParams</span><span class="p">,</span> <span class="nx">actualParams</span><span class="p">;</span>
       <span class="nx">allParams</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span>
          <span class="nx">template</span><span class="p">.</span><span class="nx">template</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\{[^}]*\}/g</span><span class="p">),</span>  <span class="c1">// Find all template substrings</span>
          <span class="kd">function</span> <span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
             <span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[{}]/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>        <span class="c1">// Strip off the braces</span>
          <span class="p">}</span>
       <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Select the subset of template parameters that don't end with a "?"</p>             </td>             <td class="code">               <div class="highlight"><pre>       <span class="nx">requiredParams</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span>
          <span class="nx">allParams</span><span class="p">,</span>
          <span class="kd">function</span><span class="p">(</span><span class="nx">param</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">param</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">param</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">!==</span> <span class="s2">&quot;?&quot;</span><span class="p">;</span> <span class="p">}</span>
       <span class="p">);</span>

       <span class="nx">actualParams</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>

       <span class="k">return</span> <span class="p">((</span><span class="nx">_</span><span class="p">.</span><span class="nx">difference</span><span class="p">(</span><span class="nx">requiredParams</span><span class="p">,</span> <span class="nx">actualParams</span><span class="p">)).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">},</span>


    <span class="nx">XareAllRequiredParamsPresent</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">requiredParams</span><span class="p">,</span> <span class="nx">actualParams</span><span class="p">;</span>
      <span class="nx">requiredParams</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span>
          <span class="nx">template</span><span class="p">.</span><span class="nx">template</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\{.*?[^?]\}/g</span><span class="p">),</span>
          <span class="kd">function</span> <span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[{}]/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
          <span class="p">});</span>
      <span class="nx">actualParams</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>

      <span class="k">return</span> <span class="p">((</span><span class="nx">_</span><span class="p">.</span><span class="nx">difference</span><span class="p">(</span><span class="nx">requiredParams</span><span class="p">,</span> <span class="nx">actualParams</span><span class="p">)).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">findTemplateWithMostParamMatches</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">templateUrls</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">sortedTemplateUrls</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">sortBy</span><span class="p">(</span>
          <span class="nx">templateUrls</span><span class="p">,</span>
          <span class="kd">function</span> <span class="p">(</span><span class="nx">urlTemplate</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">OSDD</span><span class="p">.</span><span class="nx">countMatchingParams</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">urlTemplate</span><span class="p">.</span><span class="nx">template</span><span class="p">);</span>
          <span class="p">});</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">last</span><span class="p">(</span><span class="nx">sortedTemplateUrls</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">countMatchingParams</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">templateUrl</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">templateParams</span><span class="p">;</span>

      <span class="nx">templateParams</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span>
          <span class="nx">templateUrl</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\{.*?\}/g</span><span class="p">),</span>
          <span class="kd">function</span> <span class="p">(</span><span class="nx">param</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">param</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[{}]/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
          <span class="p">});</span>

      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span>
          <span class="nx">templateParams</span><span class="p">,</span>
          <span class="kd">function</span><span class="p">(</span><span class="nx">memo</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">params</span><span class="p">[</span><span class="nx">item</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">memo</span> <span class="o">:</span> <span class="nx">memo</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
          <span class="p">},</span>
          <span class="mi">0</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Replace the placeholder fields in the given <code>urlTemplate</code> with the
values in <code>params</code>. Any unfilled parameter template fields are replaced
with an empty string.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">substituteTemplateParameters</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">urlTemplate</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">urlTemplate</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>interpolate all params into the url placeholders</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="o">+</span><span class="nx">key</span><span class="o">+</span><span class="s2">&quot;\\??}&quot;</span><span class="p">),</span> <span class="nx">value</span><span class="p">);</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>strip out any remaining {....?} template params</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\{.*?\?\}/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">url</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>


<span class="p">}(</span><span class="nx">jQuery</span><span class="p">,</span> <span class="nx">_</span><span class="p">));</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 